<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <span>ğŸ“Š</span>
                <span>Abowdy</span>
            </div>
            <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle sidebar">
                <span id="sidebar-toggle-icon">â—€</span>
            </button>
        </div>
        
        <nav class="sidebar-nav">
            <div class="sidebar-nav-item">
                <a href="/" class="sidebar-nav-link" data-tooltip="Users">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span>Users</span>
                </a>
            </div>
            <div class="sidebar-nav-item">
                <a href="/apps" class="sidebar-nav-link" data-tooltip="Applications">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span>Apps</span>
                </a>
            </div>
            <div class="sidebar-nav-item">
                <a href="/dashboard" class="sidebar-nav-link active" data-tooltip="Activity">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Activity</span>
                </a>
            </div>
            <div class="sidebar-nav-item">
                <a href="/account" class="sidebar-nav-link" data-tooltip="Account">
                    <span class="nav-icon">âš™ï¸</span>
                    <span>Account</span>
                </a>
            </div>
        </nav>
        
        <div class="sidebar-footer">
            <div class="sidebar-footer-actions">
                <a href="/logout" class="sidebar-footer-link">
                    <span class="nav-icon">ğŸšª</span>
                    <span>Logout</span>
                </a>
                <button class="sidebar-footer-link" onclick="toggleTheme()" style="border: none; background: transparent; width: 100%; text-align: left; cursor: pointer;" title="Toggle theme">
                    <span class="nav-icon" id="theme-icon">â˜€ï¸</span>
                    <span>Theme</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="mobile-overlay" onclick="closeMobileMenu()"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <button class="mobile-menu-btn" id="mobile-menu-btn" onclick="toggleMobileMenu()" style="display: none;">â˜° Menu</button>
            <header>
                <div class="header-content">
                    <h1>ğŸ“Š Activity</h1>
                    <p class="subtitle">Usage2 Monitor</p>
                </div>
            </header>

            <div class="stats-grid">
                <div class="stat-card adobe">
                    <div class="stat-icon">ğŸŒ</div>
                    <div class="stat-content">
                        <div class="stat-label">Web Apps</div>
                        <div class="stat-value" id="adobe-total"><%= adobeCount %></div>
                        <div class="stat-detail" id="adobe-today">0 today</div>
                    </div>
                </div>

                <div class="stat-card wrapper">
                    <div class="stat-icon">ğŸ’»</div>
                    <div class="stat-content">
                        <div class="stat-label">Desktop Apps</div>
                        <div class="stat-value" id="wrapper-total"><%= wrapperCount %></div>
                        <div class="stat-detail" id="wrapper-today">0 today</div>
                    </div>
                </div>

                <div class="stat-card combined">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-content">
                        <div class="stat-label">This Week</div>
                        <div class="stat-value" id="week-total">0</div>
                        <div class="stat-detail" id="unique-clients">0 unique clients</div>
                    </div>
                </div>
            </div>

            <div class="tab-content active">
                <div class="tab-content-header">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <h2>Recent Activity</h2>
                        <select id="source-filter" class="filter-select" onchange="filterBySource(this.value)" style="min-width: 180px;">
                            <option value="all">All Sources</option>
                            <option value="wrapper">Desktop Apps</option>
                            <option value="adobe">Web Apps</option>
                        </select>
                    </div>
                    <div class="dashboard-controls">
                        <button class="btn btn-primary" onclick="refreshData()">ğŸ”„ Refresh</button>
                        <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
                            <span id="auto-refresh-text">Enable Auto-Refresh</span>
                        </button>
                        <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸ Clear Data</button>
                    </div>
                </div>
                <div id="recent-activity" class="activity-table-container">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/ui-components.js"></script>
    <script src="/js/app.js"></script>
    <script>
        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const icon = document.getElementById('sidebar-toggle-icon');
            
            // On mobile, toggle overlay menu instead
            if (window.innerWidth <= 768) {
                toggleMobileMenu();
                return;
            }
            
            sidebar.classList.toggle('collapsed');
            
            // Save state
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
            icon.textContent = isCollapsed ? 'â–¶' : 'â—€';
        }

        // Mobile menu functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.remove('mobile-open');
            overlay.classList.remove('active');
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                closeMobileMenu();
            }
        });

        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update icon
            const icon = document.getElementById('theme-icon');
            icon.textContent = newTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize theme (default to dark)
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const themeIcon = document.getElementById('theme-icon');
            themeIcon.textContent = savedTheme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            
            // Initialize sidebar state
            const sidebar = document.getElementById('sidebar');
            const sidebarIcon = document.getElementById('sidebar-toggle-icon');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            
            // Show mobile menu button on mobile
            if (window.innerWidth <= 768) {
                mobileMenuBtn.style.display = 'block';
            }
            
            // Only restore collapsed state on desktop
            if (window.innerWidth > 768) {
                const savedSidebarState = localStorage.getItem('sidebarCollapsed') === 'true';
                if (savedSidebarState) {
                    sidebar.classList.add('collapsed');
                    sidebarIcon.textContent = 'â–¶';
                }
            }
            
            // Close mobile menu when clicking sidebar links
            const sidebarLinks = document.querySelectorAll('.sidebar-nav-link, .sidebar-footer-link');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        closeMobileMenu();
                    }
                });
            });
        });
    </script>
</body>
</html>
